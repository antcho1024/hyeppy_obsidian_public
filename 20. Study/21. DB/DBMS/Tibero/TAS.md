공유 디스크 종류
- RAW Device
- Shared Cluster File System
- TAS(Tibero Active Storage) > (3rd Party Cluster S/W가 필요 없음) 
  3rd Party Cluster S/W: 다른 회사에서 만든 클러스터링 소프트웨어로, 여러 서버(컴퓨터)를 하나처럼 묶어서 서버 중 하나가 고장 나도 서비스가 멈추지 않게 해줌

## TAS (Tibero Active Storage)
== 논리 볼륨 관리자(Logical Volume Manager) 이며 파일 시스템
> Tibero 운용에 필요한 컨트롤 파일, 데이터 파일, Redo 로그 파일 등을 저장하는 스토리지 시스템

- 공유 디스크로 사용할 경우
TAC 기능을 사용할 수 있도록 클러스터링 기능도 제공.
*별도의 3rd Party Cluster S/W 없이* 직접 디스크 장치를 관리

- 구성 요소:  TAS 인스턴스, TAS 디스크스페이스, TAS 디스크, TAS 파일

### TAS 인스턴스
TAS는 Tibero와 유사한 구조를 가지고 있지만, 데이터베이스 작업보다는 디스크 관련 메타데이터 관리에 초점
TAS 인스턴스는 클러스터 환경에서 <font color="#c0504d">공유 디스크의 메타데이터를 관리</font>하여 각 노드가 데이터를 효과적으로 읽고 쓸 수 있도록 도움.

- TAS 인스턴스의 경량성:
	TAS는 Tibero의 구조를 기반으로 만들어졌지만, 데이터베이스 작업이 아니라 *디스크 메타데이터 관리*를 주로 담당. > 복잡한 작업이 필요하지 않기 때문에 *시스템 자원을 거의 사용하지 않음*

- 메타데이터 저장:
	TAS는 메타데이터를 첫 번째 디스크스페이스에 저장
	- 디스크스페이스에 포함된 디스크 목록
	- 디스크 공간이 어떻게 할당되어 있는지에 대한 할당 정보
	- 파일과 그 별칭 정보
	- 파일의 Extent 정보 (데이터가 저장된 위치와 크기)
	- TAS 메타데이터를 위한 로그

- 데이터 접근 방식:
	Tibero 인스턴스는 TAS 인스턴스를 통해 공유 디스크의 데이터를 직접 읽고 쓰는 것이 아니라, <font color="#c0504d">TAS 인스턴스를 통해 필요한 메타데이터를 읽어 공유 디스크에 접근</font>
	ex)Tibero 인스턴스는 데이터 파일의 위치와 할당 정보를 TAS 인스턴스를 통해 얻고, 이 정보를 바탕으로 직접 공유 디스크에 접근하여 데이터를 읽거나 씁니다.
![[TAS-20241114214714251.webp]]


### TAS 디스크스페이스
TAS는 여러 개의 디스크들을 디스크스페이스(논리구조)로 관리
- 하나의 테이블스페이스 안에 여러 개의 데이터 파일에 존재하듯이 하나의 디스크스페이스 안에 여러 개의 물리적인 디스크가 존재
- 디스크스페이스를 사용하면 티베로를 운용하는 도중에 디스크를 추가하거나 제거 가능
- 디스크스페이스에 디스크를 추가하거나 제거할 경우 TAS는 디스크스페이스에 속한 모든 디스크들이 골고루 사용될 수 있도록 데이터를 자동으로 할당 단위(Allocation Unit)로 재배치한다.

디스크스페이스 안에는 **메타데이터**와 데이터베이스에서 사용하는 **데이터 파일들이 저장**.
하나의 디스크스페이스는 **한 인스턴스에서만 사용할 수 있지만**, 클러스터 환경(TAC)에서는 여러 인스턴스가 함께 접근할 수 있음.


### 미러링과 실패그룹
**미러링**: <font color="#c0504d">데이터 손실 방지</font> 기능 (EXTERNAL 옵션임. 외부 미러링 솔루션이 있을경우 기능 끄기 가능)
	디스크스페이스에 저장된 데이터에 대해서 미러링 가능함. 
	👇중복 레벨 설정 > 디스크스페이스 생성시 설
	- *NORMAL*      :  2-Way 방식 : 두 개의 디스크에 데이터를 복제하여 저장.
	- *HIGH*            : 3-Way 방식 : 세 개의 디스크에 데이터를 복제하여 저장.
	- *EXTERNAL*   : 미러링x. ex) 외부 미러링 솔루션이 있을 경우

**실패그룹**: 특정 디스크들을 하나의 그룹으로 묶어 관리하는 개념
미러링한 개수만큼 실패그룹 생성됨.
	ex) 중복 레벨이 NORMAL인 경우 최소 두 개의 실패그룹을 정의해야 하고, HIGH인 경우 최소 세 개의 실패그룹을 정의필요

SQL예제: 미러링 *NORMAL* / 실패그룹 *2개*
```SQL
CREATE DISKSPACE ds0 NORMAL REDUNDANCY # 수정불가능
FAILGROUP fg1 DISK
    '/dev/disk101' NAME disk101,
    '/dev/disk102' NAME disk102,
    '/dev/disk103' NAME disk103,
    '/dev/disk104' NAME disk104
FAILGROUP fg2 DISK
    '/dev/disk201' NAME disk201,
    '/dev/disk202' NAME disk202,
    '/dev/disk203' NAME disk203,
    '/dev/disk204' NAME disk204
ATTRIBUTE 'AU_SIZE=4M';
```

### TAS 디스크
TAS는 다음 디스크 장치들을 TAS 디스크로 사용할 수 있다 •디스크 전체 •디스크 파티션 •논리 볼륨 디스크나 Physical Volume에 대한 권한 문제는 mknod를 통하여 접근 파일(Block Device, CharacterDevice)를 생 성한 후 권한 설정을 하면 해결할 수 있다. TAS 클러스터를 구성할 때 동일한 디스크가 각 노드에서 서로 다른 이름으로 설정되어도 TAS 디스크로 사용 할 수 있다. 예를 들어 같은 디스크라도 CLVM이 없다면 1번 노드에서 /dev/hdisk1로 보이고 2번 노드에서 /dev/ hdisk2로 보일 수 있는데 TAS로 구성하면 이러한 환경에서도 정상적으로 TAC를 구성할 수 있다. Disk String을 통 하여 이러한 TAS 디스크를 검색하게 되므로 아래 처럼 tasl.tip 파일에 AS_DISKSTRING 로 클러스터에 참여하는 노드들이 필요한 Disk/Raw Device를 볼 수 있도록 설정해 주면 된다. AS_DISKSTRING="/dev/tas/ TAS는 테이터 파일을 디스크스페이스에 속한 모든 디스크에 분산 저장한다. 이러한 저장 방식은 디스크스페이스 에 속한 모든 디스크의 공간을 균일하게 사용하도록 하여 모든 디스크에 동일한 입출력 부하가 가해지도록 한다. 그러므로 디스크스페이스를 구성하는 TAS 디스크들은 물리적으로 서로 다른 디스크 장치여야 효과가 좋다. RAID로 Logical Volume을 구성할 때 Striping Size가 TAS AU Size의 배수로 하는 것을 권장한다. 이렇게 해야 디 스크의 Striping 단위와 TAS의 Striping 단위의 Align이 맞아 성능이 향상된다. 할당 단위(Allocation Unit) 하나의 디스크스페이스에 속한 모든 디스크의 공간은 동일한 할당 단위로 나누어진다. 할당 단위는 디스크스페이스에 서 공간 할당에 사용하는 기본 단위이다. 하나의 Extent는 한 개 혹은 여러 개의 할당 단위를 사용하며, 하나의 TAS 파 일은 한 개 혹은 여러 개의 Extent를 가진다. 디스크스페이스에서 사용할 할당 단위의 크기는 디스크스페이스를 생성할 때 AU_SIZE 속성으로 설정할 수 있으며, 설 정 가능한 값은 1MB, 2MB, 4MB, 8MB, 16MB, 32MB 또는 64MB이다. •디스크스페이스-<디스크(디스크 전체 디스크 파티션, 논리 볼륨) •디스크스페이스-TAS 파일 - Extent - <할당 단위(AU_SIZE)

**TAS 디스크**는 **Tibero Active Storage (TAS)**에서 데이터를 저장하기 위해 사용하는 디스크 장치로, **디스크 전체, 디스크 파티션, 또는 논리 볼륨**을 사용할 수 있습니다. 이 디스크들은 클러스터 환경에서 여러 노드가 접근할 수 있게 설정할 수 있습니다.

### TAS 디스크의 주요 개념

1. **사용 가능한 디스크 장치**:
    
    - **디스크 전체**: 하나의 전체 디스크를 사용할 수 있습니다.
    - **디스크 파티션**: 디스크의 특정 파티션만을 사용할 수 있습니다.
    - **논리 볼륨(Logical Volume)**: LVM(Logical Volume Manager)으로 관리되는 논리 볼륨을 사용할 수 있습니다.
2. **권한 설정**:
    
    - 디스크나 물리적 볼륨에 대한 권한 문제가 있을 때, **mknod 명령어로 접근 파일**(Block Device나 Character Device)을 생성하고 권한을 설정하여 접근 권한을 부여할 수 있습니다.
3. **디스크 이름 차이 허용**:
    
    - 클러스터 환경에서는 **노드마다 같은 디스크가 다른 이름으로 보일 수 있지만**, TAS는 이를 처리할 수 있습니다.
    - 예를 들어, 1번 노드에서는 `/dev/hdisk1`, 2번 노드에서는 `/dev/hdisk2`로 보이더라도 TAS 설정을 통해 **동일한 디스크로 인식**할 수 있습니다.
    - 이를 위해 **AS_DISKSTRING** 설정을 통해 각 노드가 동일한 디스크를 사용할 수 있도록 `tasl.tip` 파일에 설정합니다.
4. **디스크 분산 저장 및 균등한 입출력 부하**:
    
    - **데이터 파일을 TAS 디스크스페이스의 모든 디스크에 고르게 분산 저장**하여 모든 디스크에 균등한 입출력 부하가 가도록 합니다.
    - **물리적으로 다른 디스크 장치**를 사용하는 것이 더 나은 성능을 제공할 수 있습니다.
5. **RAID 구성 시 스트라이핑(Striping) 크기**:
    
    - RAID를 사용해 논리 볼륨을 구성할 때, **RAID의 스트라이핑 크기**를 **TAS 할당 단위(AU Size)**의 배수로 설정하는 것이 좋습니다.
    - 이렇게 하면 TAS의 데이터 저장 단위와 RAID 스트라이핑 단위가 맞아 떨어져서 성능이 향상됩니다.

### 할당 단위 (Allocation Unit, AU)

1. **할당 단위 개념**:
    
    - 하나의 **디스크스페이스 안의 모든 디스크는 동일한 크기의 할당 단위로 나누어집니다**. 이 할당 단위는 디스크 공간을 할당하는 기본 단위가 됩니다.
    - 데이터가 저장될 때, **하나의 Extent**(연속된 데이터 공간)가 하나 또는 여러 개의 할당 단위를 차지합니다.
    - **하나의 TAS 파일**은 여러 Extent를 가질 수 있습니다.
2. **할당 단위 크기 설정**:
    
    - 디스크스페이스 생성 시 **AU_SIZE 속성**으로 할당 단위 크기를 설정할 수 있습니다.
    - 설정 가능한 크기는 **1MB, 2MB, 4MB, 8MB, 16MB, 32MB, 64MB**이며, 이 값을 디스크스페이스의 성격에 맞춰 설정합니다.

### 요약

- **TAS 디스크**는 다양한 형태로 사용할 수 있으며, 클러스터 환경에서 여러 노드가 서로 다른 이름으로 디스크를 인식하더라도 TAS 설정을 통해 정상적으로 사용할 수 있습니다.
- **할당 단위(AU)**는 데이터 저장의 기본 단위로, 디스크스페이스 생성 시 AU 크기를 설정하여 데이터가 효율적으로 배치되도록 할 수 있습니다.
- **RAID와 TAS의 스트라이핑 단위 크기를 맞추면 성능 향상**이 가능하며, 모든 디스크에 균등한 부하를 주어 저장소 성능을 극대화합니다.

### TAS 파일
TAS 파일은 Extent의 집합으로 디스크스페이스에 저장된다. Extent는 디스크스페이스에 속한 디스크에 저장되어 있으며, 하나의 Extent는 한 개 혹은 여러 개의 할당 단위로 구성된다.

TAS는 크기가 큰 파일을 지원하기 위해 파일 크기에 따라 Extent 한 개의 크기를 변경한다. Extent 크기를 크게 하 면파일 Extent 정보를 유지하기 위한 메모리 사용을 줄이는 효과도 있다.

Extent 한 개의 크기는 파일의 크기가 커짐에 따라 자동으로 커지게 된다. Extent 한 개의 크기는 파일 크기가 작을
때는 디스크스페이스의 할당 단위(AU)와 동일하며, 파일 크기가 커지면 4MB나 16MB가 된다.

![[TAS-20241114225337462.webp]]
**AU**는 디스크의 큰 저장 공간을 나누는 단위이고, **데이터 블록**은 데이터베이스가 데이터를 읽고 쓸 때 사용하는 작은 단위...
Tibero는 **AU 단위로 디스크에 공간을 할당**하고, **그 안에 데이터 블록 단위로 실제 데이터를 저장**